<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>× ×™×”×•×œ ×›×¡×¤×™× ××™×©×™</title>
<style>
body {
  font-family: "Heebo", "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #d9f3ee, #f2fbfa);
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  direction: rtl;
}

.card {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  border-radius: 18px;
  padding: 32px 28px;
  width: 92%;
  max-width: 480px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(0, 0, 0, 0.05);
}

h2 {
  text-align: center;
  color: #00695c;
  font-size: 1.7em;
  margin-bottom: 20px;
}

label {
  display: block;
  font-weight: 600;
  margin-top: 14px;
  color: #004d40;
}

input[type=text],
input[type=number] {
  width: 100%;
  padding: 11px 12px;
  margin-top: 6px;
  border-radius: 10px;
  border: 1px solid #b2dfdb;
  background: #fdfefe;
  font-size: 1rem;
  box-sizing: border-box;
  transition: all 0.3s ease;
}

input:focus {
  outline: none;
  border-color: #009688;
  box-shadow: 0 0 6px rgba(0, 150, 136, 0.3);
}

button {
  background: linear-gradient(to right, #009688, #26a69a);
  color: #fff;
  border: none;
  padding: 13px;
  border-radius: 12px;
  width: 100%;
  cursor: pointer;
  font-weight: bold;
  margin-top: 14px;
  font-size: 1.05em;
  transition: all 0.3s ease;
}

button:hover {
  background: linear-gradient(to right, #00796b, #009688);
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(0, 150, 136, 0.25);
}

h3, h4 {
  text-align: center;
  margin-top: 18px;
  color: #00695c;
}

#productSuggestions,
#storeSuggestions,
#priceSuggestions {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;
  gap: 8px;
  margin: 8px 0 14px;
}

.suggestion {
  background: #e0f2f1;
  color: #004d40;
  border-radius: 20px;
  padding: 6px 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.95em;
  white-space: nowrap;
  border: 1px solid transparent;
}

.suggestion:hover {
  background: #b2dfdb;
  border-color: #80cbc4;
}

.purchase-item {
  background: #e0f7fa;
  border-radius: 12px;
  padding: 10px 14px;
  margin: 8px 0;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  text-align: right;
}

.purchase-item small {
  color: #555;
}

hr {
  border: none;
  height: 1px;
  background: linear-gradient(to right, transparent, #cfd8dc, transparent);
  margin: 24px 0;
}

#summaryByProduct div {
  background: #f7fcfc;
  border-radius: 8px;
  margin: 4px 0;
  padding: 6px 10px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
  font-size: 0.95em;
  color: #004d40;
}
</style>
</head>
<body>
<div class="card">
  <h2>× ×™×”×•×œ ×›×¡×¤×™× ğŸ’°</h2>

  <div id="budgetSection">
    <label>×”×›× ×¡ ×ª×§×¦×™×‘ ×—×•×“×©×™ (â‚ª):</label>
    <input type="number" id="budgetInput" placeholder="×œ×“×•×’××” 2000">
    <button onclick="setBudget()">××™×©×•×¨</button>
  </div>

  <div id="mainSection" style="display:none">
     <p id="budgetDate" style="text-align:center;color:#004d40;font-size:0.95em;margin:6px 0;"></p>
    <h3 id="remaining"></h3>
     <h4 id="dailyAverage"></h4>

    <button onclick="toggleForm()">ğŸ›’ ×§× ×™×™×” ×—×“×©×”</button>

    <div id="purchaseForm" style="display:none;margin-top:10px;">
      <label>×©× ××•×¦×¨ ğŸ“¦:</label>
      <input type="text" id="product" placeholder="×œ×“×•×’××”: ×¡×™×’×¨×™×•×ª">
      <div id="productSuggestions"></div>

      <label>×‘×™×ª ×¢×¡×§ ğŸª:</label>
      <input type="text" id="store" placeholder="×œ×“×•×’××”: ××›×•×œ×ª ×™×•×¡×™">
<div id="storeSuggestions"></div>
      <label>×¡×›×•× ğŸ’° (â‚ª):</label>
      <input type="number" id="price" placeholder="×œ×“×•×’××”: 35">
<div id="priceSuggestions"></div>
      <button onclick="addPurchase()">×”×•×¡×£ ×§× ×™×™×”</button>
    </div>

    <hr>
    <div id="purchaseList"></div>
    <hr>
    <h4>×¡×”×´×› ×œ×¤×™ ××•×¦×¨:</h4>
    <div id="summaryByProduct"></div>
    <button style="background:#ef4444;margin-top:20px" onclick="resetAll()">××™×¤×•×¡ ×”×›×œ</button>
  </div>
</div>

<script>
let storeHistory = JSON.parse(localStorage.getItem("storeHistory")) || [];
let priceHistory = JSON.parse(localStorage.getItem("priceHistory")) || [];
let data = JSON.parse(localStorage.getItem("financeData")) || null;
let productHistory = JSON.parse(localStorage.getItem("productHistory")) || [];

// ×”×’×“×¨×ª ×ª×§×¦×™×‘ ×¨××©×•× ×™
function setBudget(){
  const b = parseFloat(document.getElementById("budgetInput").value);
  if(!b || b<=0) return alert("×”×›× ×¡ ×¡×›×•× ×ª×§×™×Ÿ");
  const d = new Date();
  data = {
    start: d.toISOString(),
    month: d.getMonth(),
    total: b,
    purchases: []
  };
  localStorage.setItem("financeData", JSON.stringify(data));
  document.getElementById("budgetSection").style.display="none";
  document.getElementById("mainSection").style.display="block";
  renderAllHistories();
  updateUI();
}

// ×¤×ª×™×—×” / ×¡×’×™×¨×” ×©×œ ×˜×•×¤×¡ ×§× ×™×™×”
function toggleForm(){
  const f=document.getElementById("purchaseForm");
  f.style.display = f.style.display==="none"?"block":"none";
  renderAllHistories();
}

// ×”×•×¡×¤×ª ×§× ×™×™×” ×—×“×©×”
function addPurchase(){
  const product=document.getElementById("product").value.trim();
  const store=document.getElementById("store").value.trim();
  const price=parseFloat(document.getElementById("price").value);
  if(!product||!store||!price||price<=0) return alert("××œ× ××ª ×›×œ ×”×©×“×•×ª");

  // ×©××™×¨×ª ××•×¦×¨ ×¢× ×¤×¨×˜×™×
  const existing = productHistory.find(p => p.name === product);
  if (existing) {
    existing.store = store;
    existing.price = price;
  } else {
    productHistory.unshift({ name: product, store, price });
    if (productHistory.length > 20) productHistory.pop();
  }
  localStorage.setItem("productHistory", JSON.stringify(productHistory));

  // ×©××™×¨×ª ×©× ×”×¢×¡×§
  if(!storeHistory.includes(store)){
    storeHistory.unshift(store);
    if(storeHistory.length > 20) storeHistory.pop();
    localStorage.setItem("storeHistory", JSON.stringify(storeHistory));
  }

  // ×©××™×¨×ª ×¡×›×•×
  if(!priceHistory.includes(price)){
    priceHistory.unshift(price);
    if(priceHistory.length > 20) priceHistory.pop();
    localStorage.setItem("priceHistory", JSON.stringify(priceHistory));
  }

  // ×©××™×¨×ª ×¨×›×™×©×”
  data.purchases.push({
    product,store,price,
    date:new Date().toLocaleDateString("he-IL"),
    time:new Date().toLocaleTimeString("he-IL")
  });
  localStorage.setItem("financeData", JSON.stringify(data));

  // × ×™×§×•×™ ×©×“×•×ª
  document.getElementById("product").value="";
  document.getElementById("store").value="";
  document.getElementById("price").value="";

  // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
  renderAllHistories();
  updateUI();
}

// ×‘×—×™×¨×ª ××•×¦×¨ ×§×™×™× ××”×¨×©×™××”
function selectProduct(name, store, price){
  document.getElementById("product").value = name;
  document.getElementById("store").value = store;
  document.getElementById("price").value = price;
}

// ×‘×—×™×¨×ª ×¢×¡×§ ××• ××—×™×¨
function selectStore(name){
  document.getElementById("store").value = name;
}
function selectPrice(amount){
  document.getElementById("price").value = amount;
}

// ×”×¦×’×ª ×¨×©×™××•×ª ×”×”×™×¡×˜×•×¨×™×”
function renderProductHistory(){
  const c=document.getElementById("productSuggestions");
  if(productHistory.length===0){
    c.innerHTML="<p style='color:#777;margin:0;'>××™×Ÿ ××•×¦×¨×™× ×©××•×¨×™×</p>";
    return;
  }
  c.innerHTML=productHistory.map(
    p=>`<div class="suggestion" onclick="selectProduct('${p.name}','${p.store}','${p.price}')">${p.name}</div>`
  ).join("");
}

function renderStoreHistory(){
  const c=document.getElementById("storeSuggestions");
  if(storeHistory.length===0){ c.innerHTML=""; return; }
  c.innerHTML=storeHistory.map(
    s=>`<div class="suggestion" onclick="selectStore('${s}')">${s}</div>`
  ).join("");
}

function renderPriceHistory(){
  const c=document.getElementById("priceSuggestions");
  if(priceHistory.length===0){ c.innerHTML=""; return; }
  c.innerHTML=priceHistory.map(
    p=>`<div class="suggestion" onclick="selectPrice('${p}')">${p}</div>`
  ).join("");
}

function renderAllHistories(){
  renderProductHistory();
  renderStoreHistory();
  renderPriceHistory();
}

// ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×”×›×œ×œ×™×ª
function updateUI(){
  if(!data) return;
  document.getElementById("budgetSection").style.display="none";
  document.getElementById("mainSection").style.display="block";

  const spent=data.purchases.reduce((a,p)=>a+p.price,0);
  const remaining=data.total-spent;
  document.getElementById("remaining").textContent=`× ×©××¨ ×œ×š: ${remaining.toFixed(2)} â‚ª ××ª×•×š ${data.total.toFixed(2)} â‚ª`;
  const startDate = new Date(data.start).toLocaleDateString("he-IL");
document.getElementById("budgetDate").textContent = `×ª××¨×™×š ×”×–× ×ª ×”×ª×§×¦×™×‘: ${startDate}`;

  const start=new Date(data.start);
  const now=new Date();
  const diffDays=Math.max(1,Math.ceil((now-start)/86400000));
  const avg=spent/diffDays;
  document.getElementById("dailyAverage").textContent=`×××•×¦×¢ ×™×•××™: ${avg.toFixed(2)} â‚ª (${diffDays} ×™××™×)`;

  const list=document.getElementById("purchaseList");
  if(data.purchases.length===0){
    list.innerHTML="<p style='color:#666'>××™×Ÿ ×¢×“×™×™×Ÿ ×¨×›×™×©×•×ª</p>";
  } else {
    list.innerHTML=data.purchases.slice().reverse().map(p=>
      `<div class='purchase-item'>ğŸ“¦ ${p.product} â€” ğŸª ${p.store} â€” ğŸ’° ${p.price} â‚ª <br><small>${p.date} ${p.time}</small></div>`
    ).join("");
  }

  const summary={};
  data.purchases.forEach(p=>{
    summary[p.product]=(summary[p.product]||0)+p.price;
  });
  const summaryDiv=document.getElementById("summaryByProduct");
  summaryDiv.innerHTML=Object.keys(summary).length
    ? Object.entries(summary).map(([prod,sum])=>`<div>â€¢ ${prod}: ${sum.toFixed(2)} â‚ª</div>`).join("")
    : "<p style='color:#666'>××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</p>";
}

// ××™×¤×•×¡ ××œ×
function resetAll(){
  if(confirm("×œ××¤×¡ ×”×›×œ?")) {
    localStorage.removeItem("financeData");
    localStorage.removeItem("productHistory");
    localStorage.removeItem("storeHistory");
    localStorage.removeItem("priceHistory");
    data=null; productHistory=[]; storeHistory=[]; priceHistory=[];
    document.getElementById("budgetSection").style.display="block";
    document.getElementById("mainSection").style.display="none";
  }
}

// ×˜×¢×™× ×” ×¨××©×•× ×™×ª
if(data){
  updateUI();
  renderAllHistories();
} else {
  renderAllHistories();
}
</script>
</body>
</html>
