<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>× ×™×”×•×œ ×›×¡×¤×™× ××™×©×™</title>
<style>
body {
  font-family: "Heebo", "Segoe UI", sans-serif;
  background: linear-gradient(135deg,#c2f0e0,#e0f7fa,#f9fbe7);
  margin:0; padding:0;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh; direction:rtl;
}
.card {
  background:#ffffffcc;
  backdrop-filter:blur(8px);
  border-radius:20px;
  padding:28px;
  width:90%; max-width:460px;
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}
h2 {text-align:center;color:#00695c;}
button {
  background:linear-gradient(to right,#009688,#26a69a);
  color:#fff;border:none;padding:12px;border-radius:10px;
  width:100%;cursor:pointer;font-weight:bold;margin-top:10px;
}
button:hover {background:linear-gradient(to right,#00796b,#009688);}
input[type=text],input[type=number] {
  width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #b2dfdb;
}
.suggestion {
  display:block;
  background:#e0f2f1;
  padding:6px 10px;
  margin:3px 0;
  border-radius:8px;
  cursor:pointer;
  transition:0.2s;
  text-align:right;
}
.suggestion:hover {background:#b2dfdb;}
#productSuggestions {
  border:1px solid #b2dfdb;
  border-radius:8px;
  background:#fff;
  max-height:120px;
  overflow-y:auto;
  margin-bottom:10px;
}
.purchase-item {
  background:#e0f7fa;border-radius:10px;padding:8px 10px;margin:6px 0;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
</style>
</head>
<body>
<div class="card">
  <h2>× ×™×”×•×œ ×›×¡×¤×™× ğŸ’°</h2>

  <div id="budgetSection">
    <label>×”×›× ×¡ ×ª×§×¦×™×‘ ×—×•×“×©×™ (â‚ª):</label>
    <input type="number" id="budgetInput" placeholder="×œ×“×•×’××” 2000">
    <button onclick="setBudget()">××™×©×•×¨</button>
  </div>

  <div id="mainSection" style="display:none">
    <h3 id="remaining"></h3>
    <h4 id="dailyAverage"></h4>

    <button onclick="toggleForm()">ğŸ›’ ×§× ×™×™×” ×—×“×©×”</button>

    <div id="purchaseForm" style="display:none;margin-top:10px;">
      <label>×©× ××•×¦×¨ ğŸ“¦:</label>
      <input type="text" id="product" placeholder="×œ×“×•×’××”: ×¡×™×’×¨×™×•×ª" oninput="showSuggestions(this.value)">
      <div id="productSuggestions"></div>

      <label>×‘×™×ª ×¢×¡×§ ğŸª:</label>
      <input type="text" id="store" placeholder="×œ×“×•×’××”: ××›×•×œ×ª ×™×•×¡×™">

      <label>×¡×›×•× ğŸ’° (â‚ª):</label>
      <input type="number" id="price" placeholder="×œ×“×•×’××”: 35">

      <button onclick="addPurchase()">×”×•×¡×£ ×§× ×™×™×”</button>
    </div>

    <hr>
    <div id="purchaseList"></div>
    <hr>
    <h4>×¡×”×´×› ×œ×¤×™ ××•×¦×¨:</h4>
    <div id="summaryByProduct"></div>
    <button style="background:#ef4444;margin-top:20px" onclick="resetAll()">××™×¤×•×¡ ×”×›×œ</button>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("financeData")) || null;
let productHistory = JSON.parse(localStorage.getItem("productHistory")) || [];

function setBudget(){
  const b = parseFloat(document.getElementById("budgetInput").value);
  if(!b || b<=0) return alert("×”×›× ×¡ ×¡×›×•× ×ª×§×™×Ÿ");
  const d = new Date();
  data = {
    start: d.toISOString(),
    month: d.getMonth(),
    total: b,
    purchases: []
  };
  localStorage.setItem("financeData", JSON.stringify(data));
  document.getElementById("budgetSection").style.display="none";
  document.getElementById("mainSection").style.display="block";
  updateUI();
}

function toggleForm(){
  const f=document.getElementById("purchaseForm");
  f.style.display = f.style.display==="none"?"block":"none";
}

function addPurchase(){
  const product=document.getElementById("product").value.trim();
  const store=document.getElementById("store").value.trim();
  const price=parseFloat(document.getElementById("price").value);
  if(!product||!store||!price||price<=0) return alert("××œ× ××ª ×›×œ ×”×©×“×•×ª");

  if(!productHistory.includes(product)){
    productHistory.unshift(product);
    if(productHistory.length>20) productHistory.pop();
    localStorage.setItem("productHistory", JSON.stringify(productHistory));
  }

  data.purchases.push({
    product,store,price,
    date:new Date().toLocaleDateString("he-IL"),
    time:new Date().toLocaleTimeString("he-IL")
  });
  localStorage.setItem("financeData", JSON.stringify(data));
  document.getElementById("product").value="";
  document.getElementById("store").value="";
  document.getElementById("price").value="";
  document.getElementById("productSuggestions").innerHTML="";
  toggleForm();
  updateUI();
}

function showSuggestions(value){
  const container=document.getElementById("productSuggestions");
  if(!value){
    container.innerHTML="";
    return;
  }
  const matches=productHistory.filter(p=>p.includes(value));
  if(matches.length===0){
    container.innerHTML="";
    return;
  }
  container.innerHTML=matches.map(m=>`<div class="suggestion" onclick="selectProduct('${m}')">${m}</div>`).join("");
}

function selectProduct(name){
  document.getElementById("product").value=name;
  document.getElementById("productSuggestions").innerHTML="";
}

function updateUI(){
  if(!data) return;
  document.getElementById("budgetSection").style.display="none";
  document.getElementById("mainSection").style.display="block";

  const spent=data.purchases.reduce((a,p)=>a+p.price,0);
  const remaining=data.total-spent;
  document.getElementById("remaining").textContent=`× ×©××¨ ×œ×š: ${remaining.toFixed(2)} â‚ª ××ª×•×š ${data.total.toFixed(2)} â‚ª`;

  const start=new Date(data.start);
  const now=new Date();
  const diffDays=Math.max(1,Math.ceil((now-start)/86400000));
  const avg=spent/diffDays;
  document.getElementById("dailyAverage").textContent=`×××•×¦×¢ ×™×•××™: ${avg.toFixed(2)} â‚ª (${diffDays} ×™××™×)`;

  const list=document.getElementById("purchaseList");
  if(data.purchases.length===0){
    list.innerHTML="<p style='color:#666'>××™×Ÿ ×¢×“×™×™×Ÿ ×¨×›×™×©×•×ª</p>";
  } else {
    list.innerHTML=data.purchases.slice().reverse().map(p=>
      `<div class='purchase-item'>ğŸ“¦ ${p.product} â€” ğŸª ${p.store} â€” ğŸ’° ${p.price} â‚ª <br><small>${p.date} ${p.time}</small></div>`
    ).join("");
  }

  const summary={};
  data.purchases.forEach(p=>{
    summary[p.product]=(summary[p.product]||0)+p.price;
  });
  const summaryDiv=document.getElementById("summaryByProduct");
  summaryDiv.innerHTML=Object.keys(summary).length
    ? Object.entries(summary).map(([prod,sum])=>`<div>â€¢ ${prod}: ${sum.toFixed(2)} â‚ª</div>`).join("")
    : "<p style='color:#666'>××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</p>";
}

function resetAll(){
  if(confirm("×œ××¤×¡ ×”×›×œ?")) {
    localStorage.removeItem("financeData");
    localStorage.removeItem("productHistory");
    data=null; productHistory=[];
    document.getElementById("budgetSection").style.display="block";
    document.getElementById("mainSection").style.display="none";
  }
}

if(data) updateUI();
</script>
</body>
</html>
